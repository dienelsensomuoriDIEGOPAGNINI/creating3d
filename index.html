<!DOCTYPE html>
<html>
	<head>
		<title>creating</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
    
    <body>
        <script src="js/three.js"></script>
        <script src="js/PointerLockControls.js"></script>
        <script src="js/GLTFLoader.js"></script>
        
        <script>
           
            const scene = new THREE.Scene();
            scene.background = new THREE.Color( 0xffffff );
            scene.fog = new THREE.Fog( 0xffffff, 1, 10 );

            const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 );
            light.position.set( 0.5, 1, 0.75 );
            scene.add( light );
            
            const camera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 0.1, 1000 );
            camera.position.z = 5;


            const renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            window.addEventListener( 'resize', function( )
            {
                var width = window.innerWidth;
                var height = window.innerHeight;
                renderer.setSize( width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix( );
            } );
            
            
            controls = new THREE.PointerLockControls ( camera, renderer.domElement );
            window.addEventListener( 'click', function () {

            controls.lock();
            }, false );
 
            let moveForward = false; 
            let moveLeft = false;
            let moveBackward = false;
            let moveRight = false;
            let moveUpward = false;
            let moveDownward = false;

            const onKeyDown = function ( event ) {

                switch ( event.code ) {

                    case 'ArrowUp':
                    case 'KeyW':
                        moveForward = true;
                        break;

                    case 'ArrowLeft':
                    case 'KeyA':
                        moveLeft = true;
                        break;

                    case 'ArrowDown':
                    case 'KeyS':
                        moveBackward = true;
                        break;

                    case 'ArrowRight':
                    case 'KeyD':
                        moveRight = true;
                        break;
                    
                    case 'KeyR':
                        moveUpward = true;
                        break;

                    case 'KeyF':
                        moveDownward = true;
                        break;
                    
                    

                }

                };

                const onKeyUp = function ( event ) {

                switch ( event.code ) {

                    case 'ArrowUp':
                    case 'KeyW':
                        moveForward = false;
                        break;

                    case 'ArrowLeft':
                    case 'KeyA':
                        moveLeft = false;
                        break;

                    case 'ArrowDown':
                    case 'KeyS':
                        moveBackward = false;
                        break;

                    case 'ArrowRight':
                    case 'KeyD':
                        moveRight = false;
                        break;
                    
                    case 'KeyR':
                        moveUpward = false;
                        break;

                    case 'KeyF':
                        moveDownward = false;
                        break;

                }

            };

            document.addEventListener( 'keydown', onKeyDown );
            document.addEventListener( 'keyup', onKeyUp );

            
            const  loader = new THREE.GLTFLoader();
            loader.load( 'models/textureblg.glb', 
            function ( gltf ) {
                model = gltf.scene
                scene.add (model);
            });

            loader.load( 'models/untitled_candele.glb', 
            function ( gltf ) {
                modelone = gltf.scene
                scene.add (modelone);
            });

            const listener = new THREE.AudioListener();
            camera.add (listener);
            const sound = new THREE.Audio (listener);
            const audioLoader = new THREE.AudioLoader ();
            audioLoader.load ('sounds/bladee.wav',
            function (buffer) {
                sound.setBuffer (buffer);
                sound.setLoop (true);
                sound.setVolume (0.5);
                //sound.play ();
            });
            
            const direction = new THREE.Vector3();
            let acceleration = new THREE.Vector3();
            let velocity = new THREE.Vector3();
            const maxAccel = 5.0;
            const maxSpeed = 2.7;
            const c = 0.15;
            const frictionC = 1 - 1*c;
            
            let prevTime = performance.now ();
            function updateControls () {
                const time = performance.now();
                const delta = ( time - prevTime ) / 1000;
                direction.x = Number( moveRight ) - Number( moveLeft );
                direction.y = Number( moveUpward ) - Number( moveDownward );
                direction.z = Number( moveForward ) - Number( moveBackward );
                direction.normalize();

                direction.multiplyScalar(maxAccel * delta * maxSpeed)

                velocity.add(direction);
                velocity.multiplyScalar(frictionC);

                controls.moveForward ( velocity.z * delta );
                controls.moveRight ( velocity.x * delta );
                camera.position.y += velocity.y * delta;
                prevTime = time;
            }

            const onWheel = function({ deltaY }) {
                if (deltaY < 0) {
                    velocity.y += 1;
                } else {
                    velocity.y -= 1;
                }
            }
            document.addEventListener( 'wheel', onWheel);

			var animate = function () {
                requestAnimationFrame ( animate );
                updateControls ();
                // model.rotation.y += 0;
                // model.position.z = 1;
                // model.position.y = -1;
                // model.position.x = 1;
                // model.rotation.y += 1;
                // modelone.position.z = 5;
                // modelone.position.y = 1;
                //modelone.rotation.x = 7;
                //modelone.rotation.z = 10;
                //modelone.rotation.y += 0.003;
                renderer.render(scene, camera);
        
			};

			animate();
		</script>
	</body>
</html>